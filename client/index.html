<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>Repubikla</title>
    <link rel="icon" href="/resources/img/logo_clean.png">

    <meta property="og:url" content="https://repubikla.org" />
    <meta property="og:title" content="Repubikla" />
    <meta property="og:description" content="Plataforma de mapeo alimentada por ciudadanos que con una estrategia de crowdsourcing busca generar y centralizar datos sobre la movilidad no motorizada en las ciudades." />

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <!-- font-awesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">

    <!-- leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css" integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==" crossorigin=""/>
    <link rel="stylesheet" href="/resources/libs/leaflet.sidebar/L.Control.Sidebar.css" />
    <link rel="stylesheet" href="/resources/libs/PruneCluster/PruneCluster.js" />

    <link rel="stylesheet" href="/resources/css/master.css">
  </head>

  <body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top">
      <a class="navbar-brand" href="#">
        <img alt="Brand" src="resources/img/logo_clean.png" width="40">
      </a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mr-auto">
          <li class="nav-item"><button type="button" class="btn btn-link text-secondary" onClick="showSidebar('sidebarAbout')">Acerca del proyecto</button></li>
          <li class="nav-item"><button type="button" class="btn btn-link text-secondary" onClick="showSidebar('sidebarFilter')">Filtrar datos</button></li>
          <li class="nav-item"><button type="button" class="btn btn-link text-secondary" onClick="showSidebar('sidebarIndicators')">Indicadores</button></li>
          <li class="nav-item"><button type="button" class="btn btn-link text-secondary" onClick="showSidebar('sidebarDownload')">Descargar datos</button></li>
          <li class="nav-item"><a class="btn btn-link text-secondary" href="https://repubikla.carto.com/maps" target="_blank">Mapas temáticos</a></li>
        </ul>

        <a class="btn btn-link text-secondary" href="https://gitlab.com/imleo/repubikla" target="_blank"><i class="fab fa-github-alt"></i>&nbsp;Nuestro github</a>
      </div>
    </nav>

    <div id="map"></div>

    <!-- sidebar-about -->
    <div id="sidebarAbout">
      <div class="clearfix my-4"></div>
      <img src="/resources/img/logo_clean.png" alt="Repubikla" class="img-fluid mb-2"></img>

      <div id="fb-root"></div>
      <div class="fb-like mb-1" data-href="https://www.facebook.com/repubikla" data-layout="button_count" data-action="like" data-size="small" data-show-faces="false" data-share="true"></div>
      <br>
      <a class="twitter-follow-button" href="https://twitter.com/repubikla">Follow @Repubikla</a>

      <p class="text-justify">Plataforma de mapeo alimentada por ciudadanos que con una estrategia de crowdsourcing busca generar y centralizar datos sobre la movilidad no motorizada en las ciudades.</p>
      <p class="text-justify">Surge con el objetivo de complementar información oficial y ofrecer un diagnóstico sobre el volumen y la diversidad de los desplazamientos ciclistas, la intermodalidad, la movilidad en grupo, la infraestructura, la siniestralidad y la inseguridad en el espacio público. Así los tomadores de decisión y la sociedad civil quedan dotados de una herramienta de diagnóstico para impulsar y diseñar mejores condiciones para una movilidad sustentable y segura.</p>
      <p class="text-justify">Los datos son puestos para su descarga libre en la <a href="#" onClick="showSidebar('sidebarDownload')">sección de descarga</a>, además puedes usarlos para <a href="#" onClick="showSidebar('sidebarIndicators')">generar indicadores</a> en zonas de tú interés.</p>
    </div>

    <!-- sidebar-download -->
    <div id="sidebarDownload">
      <h3>Descargar datos</h3>

      <div class="text-center">
        <div class="row">
          <button id="downloadPoints" data-loading-text="<i class='fa fa-circle-o-notch fa-spin'></i>" class="btn btn-primary" onclick="window.downloadData(this.id,'puntos');" style="width:180px;margin-top:3px;"><img src="resources/img/icons/point.png" width="20" class="img-responsive" style='display:inline-block;'><span style='display:inline-block;'>&nbsp;Descargar puntos</span></button>
        </div>

        <div class="row">
          <button id="downloadRoutes" data-loading-text="<i class='fa fa-circle-o-notch fa-spin'></i>" class="btn btn-primary" onclick="window.downloadData(this.id,'rutas');" style="width:180px;margin-top:3px;"><img src="resources/img/icons/route.png" width="20" class="img-responsive" style='display:inline-block;'><span style='display:inline-block;'>&nbsp;Descargar rutas</span></button>
        </div>

        <div class="row">
          <button id="downloadZones" data-loading-text="<i class='fa fa-circle-o-notch fa-spin'></i>" class="btn btn-primary" onclick="window.downloadData(this.id,'zonas');" style="width:180px;margin-top:3px;"><img src="resources/img/icons/zone.png"  width="20" class="img-responsive" style='display:inline-block;'><span style='display:inline-block;'>&nbsp;Descargar zonas</span></button>
        </div>
      </div>
    </div>

    <!-- sidebar-filters -->
    <div id="sidebarFilter">
      <h3>Filtrar datos</h3>

      <label for="pointTypeFilter">Mostrar puntos de tipo: </label>
      <select class="selectpicker" id="pointTypeFilter"  multiple data-selected-text-format="count > 3" data-width="100%" data-actions-box="true" data-count-selected-text="{0} items seleccionados" data-deselect-all-text='Desmarcar todos' data-select-all-text="Marcar todos" data-none-selected-text="No mostrar puntos">
        <option value="Incidente vial">Incidente vial</option>
        <option value="Asalto">Asalto</option>
        <option value="Robo de bicicleta en estacionamiento">Robo de bicicleta en estacionamiento</option>
        <option value="Robo de bicicleta estacionada en la calle">Robo de bicicleta estacionada en la calle</option>
        <option value="Bicicleta blanca">Bicicleta blanca</option>
        <option value="Cruce peligroso">Cruce peligroso</option>
        <option value="Diseño urbano peligroso">Diseño urbano peligroso</option>
        <option value="Condiciones peligrosas">Condiciones peligrosas</option>
        <option value="Comercio/Servicio Bikefriendly">Comercio/Servicio Bikefriendly</option>
        <option value="Colectivo/Punto de encuentro">Colectivo/Punto de encuentro</option>
        <option value="Vehículos estacionados en carril confinado">Vehículos estacionados en carril confinado</option>
        <option value="Vehículos en movimiento en carril confinado">Vehículos en movimiento en carril confinado</option>
        <option value="Comercio en carril confinado">Comercio en carril confinado</option>
        <option value="Invasión recurrente de banqueta">Invasión recurrente de banqueta</option>
      </select>

      <label for="routeTypeFilter">Mostrar rutas con motivo: </label>
      <select class="selectpicker" id="routeTypeFilter"  multiple data-selected-text-format="count > 3" data-width="100%" data-actions-box="true" data-count-selected-text="{0} items seleccionados" data-deselect-all-text='Desmarcar todos' data-select-all-text="Marcar todos" data-none-selected-text="No mostrar rutas">
        <option value="Ir al trabajo">Ir al trabajo</option>
        <option value="Regreso a casa">Regreso a casa</option>
        <option value="Desplazamientos de trabajo">Desplazamientos de trabajo</option>
        <option value="Estudios">Estudios</option>
        <option value="Visitas">Visitas</option>
        <option value="Compras">Compras</option>
        <option value="Paseo, turismo">Paseo, turismo</option>
        <option value="Deporte">Deporte</option>
        <option value="Comida">Comida</option>
        <option value="Otra actividad">Otra actividad</option>
      </select>

      <label for="zoneTypeFilter">Mostrar zonas de características: </label>
      <select class="selectpicker" id="zoneTypeFilter"  multiple data-selected-text-format="count > 3" data-width="100%" data-actions-box="true" data-count-selected-text="{0} items seleccionados" data-deselect-all-text='Desmarcar todos' data-select-all-text="Marcar todos" data-none-selected-text="No mostrar zonas">
        <option value="zona_agradable">Agradable</option>
        <option value="zona_desagradable">Desagradable, hostil</option>
        <option value="zona_comoda">Cómoda, con buen diseño de calles y mobiliario</option>
        <option value="zona_incomoda">Incomoda, con mal diseño de calles y mobiliario</option>
        <option value="zona_comercio">Con concentración de comercios y servicios útiles</option>
        <option value="zona_conectada">Bien conectada</option>
        <option value="zona_no_conectada">Mal conectada</option>
        <option value="zona_insegura">Insegura (a nivel personal)</option>
        <option value="zona_no_iluminada">Mal iluminada</option>
        <option value="zona_transito">Tránsito confuso y peligroso</option>
        <option value="zona_no_mantenimiento">Mal mantenimiento (pavimento, instalaciones)</option>
      </select>

      <div class="pull-right" style="margin-top:5px;">
        <button id="applyFilters" class="btn btn-primary">Aplicar filtros</button>
        <button id="cleanFilters" class="btn btn-default">Limpiar filtros</button>
      </div>
    </div>

    <!-- sidebar indicators -->
    <div id="sidebarIndicators">
      <h3>Indicadores</h3>
      <h4 class="text-primary">Estos indicadores se generan con la extensión de la vista actual del mapa y su procesamiento consume recursos de tu computadora.</h4>
      <hr>

      <h4>Los 10 cruces con mayor número de incidentes viales.</h4>
      <div class="form-group form-inline">
        <label for="topBufferSize">Tamaño del buffer (metros):</label>
        <input type="number" class="form-control" id="topBufferSize" value="20">
      </div>
      <button type="button" class="btn btn-link btn-xs hidden" onclick="downloadTopDangerousResults()" id="downloadTopDangerous">Descargar resultados</button>
      <pre id="resultTopDangerous"></pre>
      <!-- <small class="text-muted">* Este proceso consume recursos de tu computadora.</small> -->

      <div class="pull-right">
        <button type="button" class="btn btn-primary" onclick="getTopDangerous()">Generar</button>
        <button type="button" class="btn btn-link" onclick="clearIndicators()">Limpiar</button>
      </div>
    </div>

    <script>
      window.twttr = (function(d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0],
          t = window.twttr || {};

        if (d.getElementById(id)) return t;

        js = d.createElement(s);
        js.id = id;
        js.src = "https://platform.twitter.com/widgets.js";
        fjs.parentNode.insertBefore(js, fjs);

        t._e = [];
        t.ready = function(f) {
          t._e.push(f);
        };

        return t;
      }(document, "script", "twitter-wjs"));

      (function(d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) return;
        js = d.createElement(s); js.id = id;
        js.src = "//connect.facebook.net/es_LA/sdk.js#xfbml=1&version=v2.7";
        fjs.parentNode.insertBefore(js, fjs);
      }(document, 'script', 'facebook-jssdk'));
    </script>

    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

    <!-- leaflet -->
    <script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js" integrity="sha512-GffPMF3RvMeYyc1LWMHtK8EbPv0iNZ8/oTtHPx9/cc2ILxQ+u905qIwdpULaqDkyBKgOaB57QTMg7ztg8Jm2Og==" crossorigin=""></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet.locatecontrol@0.65.1/src/L.Control.Locate.min.js"></script>
    <script src="/resources/libs/leaflet-groupedlayercontrol/leaflet.groupedlayercontrol.min.js"></script>
    <script src="/resources/libs/leaflet-dialog/Leaflet.Dialog.js"></script>
    <script src="/resources/libs/leaflet-sidebar-v2/leaflet-sidebar.js"></script>
    <script src="/resources/libs/leaflet.sidebar/L.Control.Sidebar.js"></script>
    <script src="/resources/libs/leaflet-heat.js"></script>
    <script src="/resources/libs/leaflet-hash.js"></script>
    <script src="https://api.mapbox.com/mapbox.js/plugins/leaflet-draw/v0.4.10/leaflet.draw.js"></script>
    <script src="/resources/libs/PruneCluster/PruneCluster.js"></script>
    <!-- spin -->
    <script src="/resources/libs/spin.js/spin.js"></script>
    <script src="/resources/libs/spin.js/leaflet.spin.min.js"></script>

    <!-- locale -->
    <script src="/resources/libs/leaflet.draw.locale.es.js"></script>

    <script src="/resources/js/carto.js" charset="utf-8"></script>
    <script src="/resources/js/point.js" charset="utf-8"></script>
    <script src="/resources/js/route.js" charset="utf-8"></script>
    <script src="/resources/js/zone.js" charset="utf-8"></script>
    <script src="/resources/js/map.js" charset="utf-8"></script>
    <script src="/resources/js/master.js" charset="utf-8"></script>
  </body>
</html>
