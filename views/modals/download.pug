#downloadModal.modal.fade(tabindex='-1' role='dialog' aria-labelledby='downloadModalLabel' aria-hidden='true')
  .modal-dialog.modal-lg(role='document')
    .modal-content
      .modal-header
        h5#downloadModalLabel.modal-title Descargar datos
        button.close(type='button' data-dismiss='modal' aria-label='Close')
          span(aria-hidden='true') &times;
      .modal-body
        .contaier
          .row
            .col-4
              .form-group
                label(for="downloadTypeResource") Capa:
                select.form-control.form-control-sm#downloadTypeResource
                  option(data-type="points") Puntos
                  option(data-type="routes") Rutas
                  option(data-type="zones") Zonas
                
              .text-center.mt-2
                button#downloadButton.btn.btn-primary.m-auto(onclick="downloadData();") Descargar

            .col-8
              p.mb-2 Extensi√≥n:
              #downloadMapDiv.w-100(style="height:500px;")

script.
  $("#downloadModal").on("show.bs.modal", function(){
    hideSidebars();
  });
  
  $("#downloadModal").on("shown.bs.modal", function(){
    if( !window.downloadMap ){
      window.downloadMap = L.map("downloadMapDiv", {});
        
      var wikimedia = L.tileLayer('https://maps.wikimedia.org/osm-intl/{z}/{x}/{y}{r}.png', {
        attribution: '<a href="https://wikimediafoundation.org/wiki/Maps_Terms_of_Use">Wikimedia</a>'
      }).addTo(downloadMap);
    }
    
    downloadMap.fitBounds( map.getBounds() );
    downloadMap.zoomIn();
  });
  
  function sendGeojson(geojson, filename){
    var text = JSON.stringify(geojson);
    var file = new File([text], filename, { type: "application/json;charset=utf-8" });
    saveAs(file);
  }
  
  function downloadData(){
    $("#downloadButton").prop("disabled", true);
    var bounds = downloadMap.getBounds();
    
    var resource = $("#downloadTypeResource").find(":selected").data("type");
    if(resource == "points"){
      getPoints(bounds, function(data){
        sendGeojson(data, "puntos");
        
        $("#downloadButton").prop("disabled", false);
      });
    }else if(resource == "routes"){
      getRoutes(bounds, function(data){
        sendGeojson(data, "rutas");
        
        $("#downloadButton").prop("disabled", false);
      });
    }else if(resource == "zones"){
      getZones(bounds, function(data){
        sendGeojson(data, "zonas");
        
        $("#downloadButton").prop("disabled", false);
      });
    }
    
  }
